trigger:
- none

pool:
  name:    PredatorAgentPool

variables:
- group: SQLDB   # links your library


steps:

# 1️⃣ Build Docker image locally
- task: Docker@2
  displayName: Build Docker image
  inputs:
    command: build
    Dockerfile: WebApps/GeekFormAI/backend/Dockerfile
    tags: geekform-backend:v1

# 2️⃣ Deploy to k3s via Helm
- script: |
    echo "Deploying GeekForm backend to k3s..."
    cd WebApps/GeekFormAI/backend/app/helm/geekform-backend
    helm upgrade --install geekform . \
      --set postgres.password=$(POSTGRES_PASSWORD) \
      --set image.pullPolicy=Never
  displayName: Deploy via Helm